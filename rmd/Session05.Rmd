---
title: "Session05"
author: "Susumu Shikano"
date: "Last compiled at `r format(Sys.Date(), '%d. %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Poisson process

We reconstruct the Poisson distribution by using the Poisson process with the exponential distribution.


We can first create 1000 sequential events which take place with intervals generated by the exponential distribution with $\lambda=2$:

```{r}
event.interval <- rexp(1000,rate=2)

hist(event.interval, main="Interval between events",freq=F,xlab="interval")
```

By cumulating the intervals, we can reconstruct the event's timing:

```{r}
event.timing <- cumsum(event.interval)

plot(event.timing,rep(1,length(event.timing)),type="h",main="Timing of individual events",
     xlab="Time",ylab="freq")
```

We now count every two units of the time scale frequencies of events:

```{r}

event.timing.cut <- cut(event.timing,breaks = seq(0,ceiling(max(event.timing)),by=2))

freq.events <- table(table(event.timing.cut))

plot(freq.events/sum(freq.events),
     main="Frequencies of events at every two time units",
     xlab="frequency",ylab="probability")

```

Now we can check the Poisson distribution with $\lambda=2\times2$:

```{r}

xs <- 0:max(as.numeric(names(freq.events)))

i.lambda <- 2*2

  pmf <- dpois(xs,lambda=i.lambda)


  plot(xs,pmf,type="h",ylab="P(X)",xlab="X",
       main=paste("lambda","=",i.lambda))

```

## Markov chain

We can start with a very simple case with $M=2$. The transition matrix is correspndingly $2 \times 2$:


```{r }
Q <- rbind(c(0.7,0.3),c(0.1,0.9))
  
Q
```

We can further set up the initial probability for the two states:

```{r}
X0 <- 1
```


We can update once:

```{r}
X1 <- sample(1:2,size=1,prob=Q[X0,])
X1
```

Now we can repeat this process:

```{r}
n.sim <- 500

X <- rep(NA,n.sim)

X[1] <- sample(1:2,size=1,prob=Q[X0,])
for (i.sim in 2:n.sim){
  X[i.sim] <- sample(1:2,size=1,prob=Q[X[i.sim-1],])
}

plot(X,type="b",xlab="Iterations")
par(new=T)
running.mean <- cumsum(X)/c(1:length(X))
plot(running.mean,ylim=c(1,2),type="l",col="red",
     ann=F,axes=F)

```

In the course of the time, the mean of $X$ converges to the value around 1.75.

This can be also observed if we apply the transition matrix after each other:


```{r}
Q%*%Q

Q%*%Q%*%Q

Q%*%Q%*%Q%*%Q

Q%*%Q%*%Q%*%Q%*%Q

```

Now, we can continue this process:

```{r}

all.Q <- vector(mode="list",length = n.sim)
all.Q[[1]] <- Q

for (i.sim in 2:n.sim){
  all.Q[[i.sim]] <- all.Q[[i.sim-1]]%*%Q
}


```


After 500 iterations, the product of all transition matrices is:

```{r}
all.Q[[n.sim]]
```

Here, the both rows are identical to each other. That means, independently which value X has in the previous iteration, X will have the values with the same probability. That is, the distribution became stationary.





